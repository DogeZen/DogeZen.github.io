<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh_CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="doge">
<meta property="og:type" content="website">
<meta property="og:title" content="柴犬的博客">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="柴犬的博客">
<meta property="og:description" content="doge">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Doge">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/2/"/>





  <title>柴犬的博客</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">柴犬的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">持续搬迁中</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/14/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/14/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/" itemprop="url">神经网络之视觉注意力机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-14T11:14:39+08:00">
                2021-09-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SEnet-通道注意力"><a href="#SEnet-通道注意力" class="headerlink" title="SEnet:通道注意力"></a>SEnet:通道注意力</h2><p><img src="/2021/09/14/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/image-20210914115405713-16315916517651.png" alt="image-20210914115405713"></p>
<p>SE : squeeze and excitation </p>
<p>代码<a target="_blank" rel="noopener" href="https://github.com/hujie-frank/SENet">hujie-frank/SENet: Squeeze-and-Excitation Networks </a></p>
<p>输入信息为w * h * c 。</p>
<h4 id="squeeze压缩"><a href="#squeeze压缩" class="headerlink" title="squeeze压缩"></a>squeeze压缩</h4><p>先通过全局平均池化(GAP)，压缩为1 * 1 * c，即每个通道的信息都被压缩为一个数。</p>
<h4 id="excitation激活"><a href="#excitation激活" class="headerlink" title="excitation激活"></a>excitation激活</h4><p>1 * 1 * c的信息再经过一个bottleneck结构，</p>
<p>即两个全连接层先降维到 1 * 1 * c/r (r为缩减的倍数)，再升维到1 * 1 * c ，最后再sigmoid一下。</p>
<p>最后这个 1 * 1 * c  对应每个channel的权重。通过乘法，逐通道加权到先前的每个通道特征上 。</p>
<h4 id="pytorch代码"><a href="#pytorch代码" class="headerlink" title="pytorch代码"></a>pytorch代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SELayer</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, channel, reduction=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SELayer, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.fc = nn.Sequential(</span><br><span class="line">            nn.Linear(channel, channel // reduction, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),<span class="comment">#</span></span><br><span class="line">            nn.Linear(channel // reduction, channel, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.Sigmoid()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        b, c, _, _ = x.size()</span><br><span class="line">        y = self.avg_pool(x).view(b, c)</span><br><span class="line">        y = self.fc(y).view(b, c, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x * y.expand_as(x)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="CBAM-先通道注意力再空间注意力"><a href="#CBAM-先通道注意力再空间注意力" class="headerlink" title="CBAM:先通道注意力再空间注意力"></a>CBAM:先通道注意力再空间注意力</h2><p>论文<a target="_blank" rel="noopener" href="http://openaccess.thecvf.com/content_ECCV_2018/papers/Sanghyun_Woo_Convolutional_Block_Attention_ECCV_2018_paper.pdf">CBAM: Convolutional Block Attention Module</a></p>
<p>代码<a target="_blank" rel="noopener" href="https://github.com/luuuyi/CBAM.PyTorch">luuuyi/CBAM.PyTorch</a></p>
<p><img src="/2021/09/14/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/image-20210914115753965-16315918751933.png" alt="image-20210914115753965"></p>
<p>在SEnet基础上做了以下两点优化</p>
<h4 id="全局最大池化"><a href="#全局最大池化" class="headerlink" title="全局最大池化"></a>全局最大池化</h4><p>同时进行了全局平均池化和全局最大池化，并将最后结果相加，获取到1 * 1 * c矩阵。</p>
<p>再通过乘法，逐通道加权到先前的每个通道特征上 。</p>
<h4 id="空间注意力"><a href="#空间注意力" class="headerlink" title="空间注意力"></a>空间注意力</h4><p>使用了通道注意力加权后的后的特征。</p>
<p>同样分别进行全局平均和最大池化，并且把池化结果做concat操作。</p>
<p>然后经过卷积操作，降维为1个channel。</p>
<p>再经过sigmoid生成空间特征权重，对应原图中每个像素点的权重。</p>
<p>通过乘法，逐像素加权到先前的每个像素特征上 。</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChannelAttention</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_planes, ratio=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ChannelAttention, self).__init__()</span><br><span class="line">        self.avg_pool = nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        self.max_pool = nn.AdaptiveMaxPool2d(<span class="number">1</span>)</span><br><span class="line">           </span><br><span class="line">        self.fc = nn.Sequential(nn.Conv2d(in_planes, in_planes // <span class="number">16</span>, <span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                               nn.ReLU(),</span><br><span class="line">                               nn.Conv2d(in_planes // <span class="number">16</span>, in_planes, <span class="number">1</span>, bias=<span class="literal">False</span>))</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        avg_out = self.fc(self.avg_pool(x))</span><br><span class="line">        max_out = self.fc(self.max_pool(x))</span><br><span class="line">        out = avg_out + max_out</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(out)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpatialAttention</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, kernel_size=<span class="number">7</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SpatialAttention, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">2</span>, <span class="number">1</span>, kernel_size, padding=kernel_size//<span class="number">2</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        avg_out = torch.mean(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        max_out, _ = torch.<span class="built_in">max</span>(x, dim=<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        x = torch.cat([avg_out, max_out], dim=<span class="number">1</span>)</span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> self.sigmoid(x)</span><br></pre></td></tr></table></figure>



<h2 id="BAM：通道注意力和空间注意力并行，最后相加"><a href="#BAM：通道注意力和空间注意力并行，最后相加" class="headerlink" title="BAM：通道注意力和空间注意力并行，最后相加"></a>BAM：通道注意力和空间注意力并行，最后相加</h2><p>论文<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1807.06514.pdf">BAM: Bottleneck Attention Module</a></p>
<p>没啥好说的，只是从原本的串行，改为并行最后相加，和CBAM同作者。</p>
<p><img src="/2021/09/14/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B9%8B%E8%A7%86%E8%A7%89%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/image-20210914115731369-16315918531282.png" alt="image-20210914115731369"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/docker%E4%B9%8Bnvidia-docker%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/02/docker%E4%B9%8Bnvidia-docker%E5%AE%89%E8%A3%85/" itemprop="url">docker之nvidia-docker安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-02T18:05:11+08:00">
                2021-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker">官方文档</a></p>
<h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><h4 id="nvidia-显卡驱动安装"><a href="#nvidia-显卡驱动安装" class="headerlink" title="nvidia 显卡驱动安装"></a>nvidia 显卡驱动安装</h4><p>有图形界面直接软件更新-&gt;附加驱动 就能找到nvidia驱动安装</p>
<p>无图形界面需要去<a href="%5Bhttps://www.nvidia.com/Download/index.aspx?lang=en-us">下载run文件自行安装</a>，这里我有图形界面所以不去搞了。</p>
<h4 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h4><h5 id="下载并安装"><a href="#下载并安装" class="headerlink" title="下载并安装"></a>下载并安装</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure>
<h5 id="使非root用户可以直接运行docker"><a href="#使非root用户可以直接运行docker" class="headerlink" title="使非root用户可以直接运行docker"></a>使非root用户可以直接运行docker</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker 你的用户名</span><br></pre></td></tr></table></figure>
<h5 id="测试安装是否成功"><a href="#测试安装是否成功" class="headerlink" title="测试安装是否成功"></a>测试安装是否成功</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<h4 id="显卡要求"><a href="#显卡要求" class="headerlink" title="显卡要求"></a>显卡要求</h4><p>显卡必须是nvdia且高于一定算力</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Ubuntu上的Docker CE可以使用Docker的官方的语句进行设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.docker.com | sh</span><br><span class="line">sudo systemctl start docker</span><br><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure>

<p>设置稳定存储库和GPG密钥：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \</span><br><span class="line">   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - \</span><br><span class="line">   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br></pre></td></tr></table></figure>
<p>在更新包列表后安装nvidia-docker2包（和依赖项）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line">sudo apt-get install -y nvidia-docker2</span><br></pre></td></tr></table></figure>

<p>设置默认运行时间后，重新启动Docker守护程序完成安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>去<a target="_blank" rel="noopener" href="https://hub.docker.com/r/nvidia/cuda/tags">nvidia cuda仓库</a>下载最新的docker 并测试nvidia-smi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --rm --gpus all --name tyl-docker  nvidia/cuda:11.4.1-devel-ubuntu18.04</span><br></pre></td></tr></table></figure>

<p>如果需要pytorch的docker，可以直接去<a target="_blank" rel="noopener" href="https://ngc.nvidia.com/catalog/containers/nvidia:pytorch/tags">PyTorch | NVIDIA NGC</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/docker%E5%BC%80%E5%90%AFssh%E8%BF%9E%E6%8E%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/02/docker%E5%BC%80%E5%90%AFssh%E8%BF%9E%E6%8E%A5/" itemprop="url">docker开启ssh连接</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-02T17:08:40+08:00">
                2021-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-创建docker"><a href="#1-创建docker" class="headerlink" title="1.创建docker"></a>1.创建docker</h4><p>创建docker时把22端口绑定到宿主机端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name 容要创建的容器名  -p 主机端口:容器端口 要使用的镜像名</span><br></pre></td></tr></table></figure>

<h4 id="2-安装docker的ssh"><a href="#2-安装docker的ssh" class="headerlink" title="2.安装docker的ssh"></a>2.安装docker的ssh</h4><p>更新源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure>

<p>安装ssh-server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install openssh-server</span><br></pre></td></tr></table></figure>

<h4 id="3-设置ssh，允许root登录"><a href="#3-设置ssh，允许root登录" class="headerlink" title="3.设置ssh，允许root登录"></a>3.设置ssh，允许root登录</h4><p>即往/etc/ssh/sshd_config添加一行PermitRootLogin yes</p>
<p>然后重启ssh服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">service ssh restart</span><br></pre></td></tr></table></figure>

<h4 id="4-初始化root密码"><a href="#4-初始化root密码" class="headerlink" title="4.初始化root密码"></a>4.初始化root密码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd root</span><br></pre></td></tr></table></figure>

<h4 id="5-密钥登录设置"><a href="#5-密钥登录设置" class="headerlink" title="5.密钥登录设置"></a>5.密钥登录设置</h4><p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/set-ssh-login-key.html">设置 SSH 通过密钥登录 | 菜鸟教程 (runoob.com)</a></p>
<p>docker内和自己主机各自生成密钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>

<h5 id="docker内"><a href="#docker内" class="headerlink" title="docker内"></a>docker内</h5><p>新建authorized_keys,并且把自己主机上的公钥拷到里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim authorized_keys</span><br></pre></td></tr></table></figure>

<p>修改ssh目录和authorized_keys权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 authorized_keys</span><br><span class="line">chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure>

<p>设置ssh密钥登录</p>
<p>/etc/ssh/sshd_config加上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;PubkeyAuthentication yes&quot; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">service ssh restart</span><br></pre></td></tr></table></figure>

<h5 id="主机vscode访问"><a href="#主机vscode访问" class="headerlink" title="主机vscode访问"></a>主机vscode访问</h5><p>修改.ssh文件的config文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host xxx.xxx.xxx.xxx</span><br><span class="line">  HostName xxx.xxx.xxx.xxx</span><br><span class="line">  Port xxxx</span><br><span class="line">  User xxxx</span><br><span class="line">  IdentityFile C:\Users\用户名\.ssh\id_rsa(你的私钥文件地址)</span><br></pre></td></tr></table></figure>




          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/docker%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/02/docker%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/" itemprop="url">docker命令整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-02T13:53:03+08:00">
                2021-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-command-manual.html">菜鸟教程合集</a></p>
<h4 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br><span class="line">docker ps -a</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h4 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name 容要创建的容器名  -p 主机端口:容器端口 要使用的镜像名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name tyl_pytorch  -p 1227:22 c35f519fe286</span><br></pre></td></tr></table></figure>

<ul>
<li>–name 容器名</li>
<li>-p: 指定端口映射，格式为：主机端口:容器端口</li>
<li>-it i 以交互模式运行容器 t 为容器重新分配一个伪输入终端</li>
<li>-v /宿主机目录:/容器目录 将宿主机目录挂载到容器里</li>
</ul>
<h4 id="更新容器配置"><a href="#更新容器配置" class="headerlink" title="更新容器配置"></a>更新容器配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update [OPTIONS] 容器名</span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart=always tyl-docker</span><br></pre></td></tr></table></figure>

<h4 id="连接docker-退出docker"><a href="#连接docker-退出docker" class="headerlink" title="连接docker,退出docker"></a>连接docker,退出docker</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach 容器名</span><br></pre></td></tr></table></figure>

<p>在<code>docker</code>容器中使用<code>Ctrl+D</code>即可退出容器，同时停止容器</p>
<p>如果想退出容器但又不想让容器停止，使用<code>Ctrl+P+Q</code>即可</p>
<h4 id="拷贝文件-CP"><a href="#拷贝文件-CP" class="headerlink" title="拷贝文件:CP"></a>拷贝文件:CP</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器目录  外部目录</span><br><span class="line">docker cp 外部目录  容器id:容器目录 </span><br></pre></td></tr></table></figure>

<h4 id="根据容器创建镜像"><a href="#根据容器创建镜像" class="headerlink" title="根据容器创建镜像"></a>根据容器创建镜像</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit 容器名 要创建的镜像名</span><br></pre></td></tr></table></figure>

<h4 id="镜像导出和导入"><a href="#镜像导出和导入" class="headerlink" title="镜像导出和导入"></a>镜像导出和导入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save 镜像名&gt;导出文件名.tar</span><br><span class="line">docker load -i 导出文件名.tar</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save c372cb4b73cb&gt;pytorch1.7-cuda11.0.tar</span><br><span class="line">docker load -i pytorch1.7-cuda11.0.tar</span><br></pre></td></tr></table></figure>

<h4 id="容器导出导入"><a href="#容器导出导入" class="headerlink" title="容器导出导入"></a>容器导出导入</h4><p>导入的不是容器而是镜像，可以通过这个镜像再创建容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker export 容器名&gt;导出文件名.tar</span><br><span class="line">docker import 导出文件名.tar 创建的镜像名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker export f81d6b9b8bd5&gt;container_torch17.tar</span><br><span class="line">docker import container_torch17.tar torch17</span><br></pre></td></tr></table></figure>






          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/linux%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/02/linux%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/" itemprop="url">linux命令整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-02T11:22:03+08:00">
                2021-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h4><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><p><strong>netstat -tunlp</strong> 用于显示 tcp，udp 的端口和进程等相关情况。</p>
<p>netstat 查看端口占用语法格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep 端口号</span><br></pre></td></tr></table></figure>

<ul>
<li>-t (tcp) 仅显示tcp相关选项</li>
<li>-u (udp)仅显示udp相关选项</li>
<li>-n 拒绝显示别名，能显示数字的全部转化为数字</li>
<li>-l 仅列出在Listen(监听)的服务状态</li>
<li>-p 显示建立相关链接的程序名</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/nps%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/02/nps%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/" itemprop="url">nps反向代理实现远程连接</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-02T09:33:23+08:00">
                2021-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h4><p><a target="_blank" rel="noopener" href="https://ehang-io.github.io/nps">https://ehang-io.github.io/nps</a></p>
<h4 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h4><h5 id="1-下载并解压安装包"><a href="#1-下载并解压安装包" class="headerlink" title="1.下载并解压安装包"></a>1.下载并解压安装包</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz</span><br><span class="line">tar -zxvf linux_amd64_server.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-安装并启动nps"><a href="#2-安装并启动nps" class="headerlink" title="2.安装并启动nps"></a>2.安装并启动nps</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ./nps install</span><br><span class="line">sudo nps start</span><br></pre></td></tr></table></figure>

<p>查看启动日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/nps.log</span><br></pre></td></tr></table></figure>

<h5 id="3-修改配置文件并且重载"><a href="#3-修改配置文件并且重载" class="headerlink" title="3.修改配置文件并且重载"></a>3.修改配置文件并且重载</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nps/conf/nps.conf</span><br><span class="line">sudo nps reload</span><br><span class="line">sudo nps restart</span><br></pre></td></tr></table></figure>

<p>修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bridge_port=供客户端连接的端口</span><br><span class="line"></span><br><span class="line">web_username=网页管理端登录账号</span><br><span class="line">web_password=网页管理端登录密码</span><br><span class="line">web_port = 网页管理端访问端口</span><br></pre></td></tr></table></figure>

<h4 id="网页端添加客户端"><a href="#网页端添加客户端" class="headerlink" title="网页端添加客户端"></a>网页端添加客户端</h4><p>浏览器访问服务器端ip : web_port</p>
<p>新增客户端，设置客户端</p>
<p>新增tcp隧道，客户端id为新增的客户端id。</p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull ffdfgdfg/npc</span><br><span class="line">docker run -d --name npc --net=host --restart=always ffdfgdfg/npc -server=&lt;ip:bridge_port&gt; -vkey=&lt;web界面中显示的密钥&gt; </span><br></pre></td></tr></table></figure>

<p>查看日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs npc </span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/19/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%83%A8%E7%BD%B2%E4%B9%8Bnvdia%E6%8E%A8%E7%90%86%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8Cpt%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/19/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%83%A8%E7%BD%B2%E4%B9%8Bnvdia%E6%8E%A8%E7%90%86%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8Cpt%E6%96%87%E4%BB%B6/" itemprop="url">神经网络部署之nvdia推理服务运行pt文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-19T10:13:23+08:00">
                2021-08-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>triton server默认都是tensorrt推理。</p>
<p>但也会出现有操作不支持，导致无法转模型为engine的情况。</p>
<p>可以选择直接运行pytorch的pt文件，以下为操作步骤。</p>
<h2 id="1-pytorch后端环境编译步骤"><a href="#1-pytorch后端环境编译步骤" class="headerlink" title="1.pytorch后端环境编译步骤"></a>1.pytorch后端环境编译步骤</h2><p>原理是使用 pytorch C++ API运行pt文件模型。</p>
<h4 id="安装依赖项"><a href="#安装依赖项" class="headerlink" title="安装依赖项"></a>安装依赖项</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install patchelf rapidjson-dev python3-dev</span><br></pre></td></tr></table></figure>

<h4 id="构建NGC-的-PyTorch-容器。"><a href="#构建NGC-的-PyTorch-容器。" class="headerlink" title="构建NGC 的 PyTorch 容器。"></a>构建NGC 的 PyTorch 容器。</h4><p>例如，构建一个使用 NGC 21.02 版本的 PyTorch 容器的后端,步骤如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/triton-inference-server/pytorch_backend.git</span><br><span class="line">git checkout r21.02</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX:PATH=`pwd`/install -DTRITON_PYTORCH_DOCKER_IMAGE=&quot;nvcr.io/nvidia/pytorch:21.02-py3&quot; ..</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>以下所需的 Triton 存储库将被拉取并在构建中使用。</p>
<p>默认情况下，每个git分支的标签都是main。</p>
<p> 但以下CMake 参数可以被重新设置。</p>
<ul>
<li>triton-inference-server/backend: -DTRITON_BACKEND_REPO_TAG=[tag]</li>
<li>triton-inference-server/core: -DTRITON_CORE_REPO_TAG=[tag]</li>
<li>triton-inference-server/common: -DTRITON_COMMON_REPO_TAG=[tag]</li>
</ul>
<p>这里如果报错cmake版本过低，则</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt remove cmake</span><br><span class="line">pip install cmake --upgrade</span><br></pre></td></tr></table></figure>

<p>编译完成后会在build文件夹里产生很多库文件，这些库文件将在后续被使用</p>
<p>参考自<a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/pytorch_backend">pytorch后端配置文档</a></p>
<h2 id="2-使用编译后的共享库"><a href="#2-使用编译后的共享库" class="headerlink" title="2.使用编译后的共享库"></a>2.使用编译后的共享库</h2><p>通常情况放在triton镜像的这里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/opt/</span><br><span class="line">tritonserver/</span><br><span class="line">backends/</span><br><span class="line">mybackend/</span><br><span class="line">libtriton_mybackend.so</span><br><span class="line">... # mybackend需要的其他文件</span><br></pre></td></tr></table></figure>

<p>关于后端配置详细可以去看<a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/backend/blob/main/README.md#backends">后端配置官方文档</a></p>
<h2 id="3-pytorch模型仓库"><a href="#3-pytorch模型仓库" class="headerlink" title="3.pytorch模型仓库"></a>3.pytorch模型仓库</h2><p>此时环境准备完成，准备模型仓库即可。</p>
<p>最简的TorchScript模型仓库如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;模型仓库路径&gt;/</span><br><span class="line">  &lt;模型名&gt;/</span><br><span class="line">    config.pbtxt 配置文件</span><br><span class="line">    1/</span><br><span class="line">      model.pt pt文件</span><br></pre></td></tr></table></figure>

<p>model.pt需要由pth文件生成,示例如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> unet <span class="keyword">import</span> UNet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取模型</span></span><br><span class="line"><span class="comment"># model = UNet(n_channels=3, n_classes=1, bilinear=True)</span></span><br><span class="line"><span class="comment"># device = torch.device(&#x27;cuda&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</span></span><br><span class="line"><span class="comment"># model = model.to(device)</span></span><br><span class="line"><span class="comment"># model.load_state_dict(torch.load(&quot;checkpoints/best_0.8774614781141281.pth&quot;, map_location=device))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># model = model.eval()</span></span><br><span class="line"></span><br><span class="line">device = torch.device(<span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line">model = torch.load(<span class="string">&quot;checkpoints/best_0.8774614781141281.pth&quot;</span>, map_location=device)</span><br><span class="line">model.to(device)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建输入tensor</span></span><br><span class="line">dummy_input = torch.ones(<span class="number">1</span>, <span class="number">3</span>, <span class="number">360</span>, <span class="number">640</span>).to(device)</span><br><span class="line"><span class="comment"># 生成pt</span></span><br><span class="line">trace_model = torch.jit.trace(model, dummy_input)</span><br><span class="line">trace_model.save(<span class="string">&#x27;checkpoints/model.pt&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>最简单的config.pbtxt示例如下:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">platform: <span class="string">&quot;pytorch_libtorch&quot;</span></span><br><span class="line">max_batch_size: <span class="number">1</span></span><br><span class="line">input [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;INPUT__0&quot;</span></span><br><span class="line">    data_type: TYPE_FP32</span><br><span class="line">    dims: [ <span class="number">3</span>, <span class="number">360</span>, <span class="number">640</span>]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">output [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;OUTPUT__0&quot;</span></span><br><span class="line">    data_type: TYPE_FP32</span><br><span class="line">    dims: [ <span class="number">3</span>, <span class="number">360</span>, <span class="number">640</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>必须指定 <a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/backend/blob/main/README.md#backends">backend或platform</a>，<a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/server/blob/r21.06/docs/model_configuration.md#maximum-batch-size">max_batch_size</a>，<a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/server/blob/r21.06/docs/model_configuration.md#inputs-and-outputs">input与output</a>。</p>
<p>详细配置可以去看 <a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/server/blob/r21.06/docs/model_configuration.md">模型配置官方文档</a></p>
<h2 id="4-triton加载模型"><a href="#4-triton加载模型" class="headerlink" title="4.triton加载模型"></a>4.triton加载模型</h2><p>post请求 <u>服务器ip:端口/v2/repository/models/模型名/load</u></p>
<p>返回为空的话说明成功加载</p>
<h2 id="5-flask编写客户端接收图片返回识别结果"><a href="#5-flask编写客户端接收图片返回识别结果" class="headerlink" title="5.flask编写客户端接收图片返回识别结果"></a>5.flask编写客户端接收图片返回识别结果</h2><p>项目地址:<a target="_blank" rel="noopener" href="https://gitee.com/doge_ac_cn/triton_client_pytorch">triton_client_pytorch: 跑pt文件的nvidia client端</a></p>
<p>参考代码</p>
<p><a target="_blank" rel="noopener" href="https://github.com/triton-inference-server/client/blob/530bcac5f1574aa2222930076200544eb274245c/src/python/examples/simple_grpc_shm_client.py">client/simple_grpc_shm_client.py nvidia官方示例</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/10/python%E8%B6%85%E6%97%B6%E8%A3%85%E9%A5%B0%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/10/python%E8%B6%85%E6%97%B6%E8%A3%85%E9%A5%B0%E5%99%A8/" itemprop="url">python超时装饰器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-10T11:10:43+08:00">
                2021-08-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="安装"><a href="#安装" class="headerlink" title="安装:"></a>安装:</h4><p><code>pip3 install timeout-decorator</code> </p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>默认情况下，timeout_decorator运用signal机制。<br>不适用于非主线程运行，例如web应用的worker线程。</p>
<p>这种情况下需要使用多进程，timeout decorator设置use_signals=False。</p>
<h4 id="例-设置url下载图片8秒超时"><a href="#例-设置url下载图片8秒超时" class="headerlink" title="例:设置url下载图片8秒超时"></a>例:设置url下载图片8秒超时</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeout_decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@timeout_decorator.timeout(<span class="params"><span class="number">8</span>, use_signals=<span class="literal">False</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url_to_image</span>(<span class="params">url</span>):</span></span><br><span class="line">    resp = urllib.request.urlopen(url)</span><br><span class="line">    image = np.asarray(<span class="built_in">bytearray</span>(resp.read()), dtype=<span class="string">&quot;uint8&quot;</span>)</span><br><span class="line">    image = cv2.imdecode(image, cv2.IMREAD_COLOR)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure>



<p>原文：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7fc98c7af4d">https://www.jianshu.com/p/a7fc98c7af4d</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/" itemprop="url">服务器被黑挖矿处理和反思</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-05T14:40:51+08:00">
                2021-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="发现过程"><a href="#发现过程" class="headerlink" title="发现过程"></a>发现过程</h4><p><img src="/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/image-20210805145050245.png"></p>
<p>服务器中cpu被占了一半。命名是一个视频渲染软件，但是公司内没有人做这个。初步推断是被黑了拿来挖矿。</p>
<p>netstat -antp 后，发现有一个可疑ip 88.99.193.240:5555,确定了是被挖矿了。</p>
<p><img src="/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/image-20210805144853084.png"></p>
<h4 id="后续处理"><a href="#后续处理" class="headerlink" title="后续处理"></a>后续处理</h4><p>找了当年教我技术的师傅帮忙，大概十几分钟就处理完了。(我是菜逼呜呜呜)</p>
<p><img src="/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/image-20210805145630809.png"></p>
<p>查服务启动项定时任务，删了马。做了其他很多的安全检查。最后修改了ssh。</p>
<p>后续公司打算采用跳板机访问外网，同时把开发环境和生产环境分离成两个机器，防止环境一直变动。</p>
<h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><p>服务器开启了ssh登录，但是有个默认账户ps，密码是123456，一直没改。</p>
<p><img src="/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/image-20210805150027071.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;Failed password&quot; /var/log/auth.log</span><br></pre></td></tr></table></figure>

<p>查看尝试密码记录如下:</p>
<p><img src="/2021/08/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E6%8C%96%E7%9F%BF%E5%A4%84%E7%90%86%E5%92%8C%E5%8F%8D%E6%80%9D/image-20210805150657377.png"></p>
<p>可以看到一直被不间断尝试各个用户名密码。</p>
<p>然后ps账户的弱(智)口令密码被试了出来，随后成功进入服务器挂马。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/02/python%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/02/python%E7%89%B9%E6%80%A7/" itemprop="url">python特性整理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-02T17:48:12+08:00">
                2021-08-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-装饰器：希望添加函数功能但是不想直接重写函数。"><a href="#1-装饰器：希望添加函数功能但是不想直接重写函数。" class="headerlink" title="1.装饰器：希望添加函数功能但是不想直接重写函数。"></a>1.装饰器：希望添加函数功能但是不想直接重写函数。</h3><p>基础示例</p>
<p>在原函数前后写你需要添加的功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#接收需要装饰的函数，返回装饰完毕后的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">fuction</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fucution_after_decorate</span>():</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        fuction()</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> fucution_after_decorate</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;func&quot;</span>)</span><br><span class="line"> </span><br><span class="line">func()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">func</span><br><span class="line">1</span><br></pre></td></tr></table></figure>



<p>进阶示例:</p>
<p>计时函数<br>问题: 在flask中需要计算每个接口处理请求的耗时，并且写入log文件。如果每个接口都写一遍，项目代码会很冗长。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span> (<span class="params">fuction</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">fucution_after_decorate</span>():</span></span><br><span class="line">        <span class="comment"># 获取时间</span></span><br><span class="line">		start_time = time.time()</span><br><span class="line">		time_list,result,img_url = fuction()</span><br><span class="line">		down_time,infer_time,post_time = time_list</span><br><span class="line">		<span class="comment"># 只保存错误url</span></span><br><span class="line">		<span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] ==<span class="string">&#x27;200&#x27;</span>:</span><br><span class="line">			img_url =<span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># log</span></span><br><span class="line">		app.logger.info(fuction.__name__</span><br><span class="line">		+ <span class="built_in">str</span>(time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line">		+<span class="string">&quot; time:&quot;</span>+<span class="built_in">str</span>(<span class="built_in">round</span>(time.time()-start_time,<span class="number">4</span>))</span><br><span class="line">        +<span class="string">&quot; &quot;</span>+result[<span class="string">&#x27;code&#x27;</span>]+<span class="string">&quot; &quot;</span></span><br><span class="line">		+<span class="string">&quot; pictime:&quot;</span>+<span class="built_in">str</span>(<span class="built_in">round</span>(infer_time-down_time,<span class="number">4</span>))</span><br><span class="line">		+img_url)</span><br><span class="line">		<span class="keyword">return</span> result</span><br><span class="line">	<span class="keyword">return</span> fucution_after_decorate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求函数</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/handleHkData&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handleHkData_app</span>():</span></span><br><span class="line">    <span class="comment"># 这里内部新建一个函数</span></span><br><span class="line">    <span class="comment"># 因为flask的route直接加装饰器,会因为传入装饰器名称重名报错。</span></span><br><span class="line"><span class="meta">	@timer</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">handleHkData</span>():</span></span><br><span class="line">		img_url = request.json.get(<span class="string">&quot;img_url&quot;</span>).strip()  <span class="comment"># url</span></span><br><span class="line">		time_list,result = handleHkData(img_url)</span><br><span class="line">		<span class="keyword">return</span> time_list,result,img_url</span><br><span class="line">	<span class="keyword">return</span> handleHkData()</span><br></pre></td></tr></table></figure>

<p>log</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">handlehkData2021-08-02 17:19:19 time:1.7569 200  pictime:1.5439</span><br><span class="line">handlehkData2021-08-02 17:19:25 time:0.399 500002  pictime:0https://open.ys7.com</span><br><span class="line">handlehkData2021-08-02 17:19:31 time:2.854 200  pictime:2.8145</span><br><span class="line">workClothes_hf2021-08-02 17:19:39 time:1.3209 200  pictime:1.2829</span><br><span class="line">workClothes_jf2021-08-02 17:19:45 time:0.9909 200  pictime:0.9575</span><br></pre></td></tr></table></figure>



<h3 id="2-call方法"><a href="#2-call方法" class="headerlink" title="2.call方法"></a>2.call方法</h3><p>把对象可以像函数一样被调用。<br><a target="_blank" rel="noopener" href="http://doge.ac.cn/?p=1331">http://doge.ac.cn/?p=1331</a></p>
<h3 id="3-直接赋值-浅拷贝-深拷贝"><a href="#3-直接赋值-浅拷贝-深拷贝" class="headerlink" title="3.直接赋值 浅拷贝 深拷贝"></a>3.直接赋值 浅拷贝 深拷贝</h3><p>三种赋值方式</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">直接赋值</th>
<th align="center">浅拷贝</th>
<th align="center">深拷贝</th>
</tr>
</thead>
<tbody><tr>
<td align="center">使用方式</td>
<td align="center">a=b</td>
<td align="center">a=b.copy()</td>
<td align="center">a=b.deepcopy()</td>
</tr>
<tr>
<td align="center">原理，以list为例</td>
<td align="center">list内部和list本身都只是原对象的引用</td>
<td align="center">只隔离了list本身，内部元素还是原来list中元素的引用</td>
<td align="center">由内到外完全隔离</td>
</tr>
<tr>
<td align="center">原对象变化</td>
<td align="center">拷贝对象一起变化</td>
<td align="center">拷贝对象一起变化</td>
<td align="center">拷贝对象不变化</td>
</tr>
<tr>
<td align="center">拷贝对象list整体变化</td>
<td align="center">原对象变化</td>
<td align="center">原对象不变化</td>
<td align="center">原对象不变</td>
</tr>
<tr>
<td align="center">拷贝对象list内某个元素变化</td>
<td align="center">原对象内元素变化</td>
<td align="center">原对象内元素变化</td>
<td align="center">原对象内元素不变</td>
</tr>
</tbody></table>
<p>1.直接赋值：list内部和list本身都只是原对象的引用</p>
<p>2.浅拷贝:只隔离了list本身，内部元素还是原来list中元素的引用</p>
<p>3.深拷贝:list和内部元素都完全隔离</p>
<h3 id="4-迭代器-生成器"><a href="#4-迭代器-生成器" class="headerlink" title="4.迭代器 生成器"></a>4.迭代器 生成器</h3><p>训练时加载数据集必备，节约内存，而不是一次性加载所有数据。</p>
<p>1.迭代器</p>
<p>对可迭代对象用**iter()<strong>产生迭代器,用</strong>next()**读取。</p>
<p>如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">y = <span class="built_in">iter</span>(x)</span><br><span class="line">z = <span class="built_in">iter</span>(x)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(y),<span class="built_in">next</span>(y),<span class="built_in">next</span>(y))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(z),<span class="built_in">next</span>(z),<span class="built_in">next</span>(z))</span><br></pre></td></tr></table></figure>

<p>结果为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">1 2 3</span><br></pre></td></tr></table></figure>

<p>可以看到，两个迭代器之间是相互独立的</p>
<p>由此可见，迭代器每次被创建的时候都会把内容都写入内存，从而可以被多次迭代</p>
<p>2.生成器</p>
<p>生成器也是一种特殊的迭代器</p>
<p>生成器是一种只能迭代一次的迭代器，生成器不会一次将所有的元素存入内存中，而是一边迭代一边运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pictures_generator</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10000000000000000</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="built_in">pow</span>(i,<span class="number">10</span>)</span><br><span class="line">generator=pictures_generator()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(generator))</span><br></pre></td></tr></table></figure>

<p>这里不会一次生成包含1000000000000个元素的list用于迭代。</p>
<p>当你调用一个包含<strong>yield</strong>的函数的时候，函数体代码并不会执行，这个函数仅仅是返回一个生成器而已。</p>
<p>而这个生成器在你每次对他使用next函数时，函数体才会从执行到yield处，然后返回yield的值，然后暂停等待你的下次调用。</p>
<p>从而节约了大量的内存。</p>
<h3 id="5-定制类"><a href="#5-定制类" class="headerlink" title="5.定制类"></a>5.定制类</h3><p>改写例如str(),len()对类的效果。<br><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017590712115904">https://www.liaoxuefeng.com/wiki/1016959663602400/1017590712115904</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">&gt;</a>
  </nav>




          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Doge</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
