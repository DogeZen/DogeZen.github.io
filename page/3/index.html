<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh_CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="doge">
<meta property="og:type" content="website">
<meta property="og:title" content="柴犬的博客">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="柴犬的博客">
<meta property="og:description" content="doge">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Doge">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/3/"/>





  <title>柴犬的博客</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">柴犬的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">持续搬迁中</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/27/docker%20file%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/27/docker%20file%E7%AC%94%E8%AE%B0/" itemprop="url">docker file 笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-27T17:58:00+08:00">
                2021-07-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="docker-file-使用示例"><a href="#docker-file-使用示例" class="headerlink" title="docker file 使用示例"></a>docker file 使用示例</h2><p>docker build命令用于从Dockerfile构建映像。</p>
<p>**-f :**指定要使用的Dockerfile路径；</p>
<p><strong>–tag, -t:</strong> 镜像的名字及标签;</p>
<p>示例:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /path/to/a/Dockerfile</span><br><span class="line">docker build -t SOLO docker/</span><br></pre></td></tr></table></figure>

<h2 id="docker-file结构"><a href="#docker-file结构" class="headerlink" title="docker file结构"></a>docker file结构</h2><h3 id="FROM：指定基础镜像，必须为第一个命令"><a href="#FROM：指定基础镜像，必须为第一个命令" class="headerlink" title="FROM：指定基础镜像，必须为第一个命令"></a><strong>FROM：指定基础镜像，必须为第一个命令</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM pytorch/pytorch:1.3-cuda10.1-cudnn7-devel</span><br></pre></td></tr></table></figure>

<h3 id="MAINTAINER-维护者信息"><a href="#MAINTAINER-维护者信息" class="headerlink" title="MAINTAINER: 维护者信息"></a><strong>MAINTAINER: 维护者信息</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAINTAINER Dodge &lt;83942052@qq.com&gt;</span><br></pre></td></tr></table></figure>

<h3 id="RUN：构建镜像时执行的命令"><a href="#RUN：构建镜像时执行的命令" class="headerlink" title="RUN：构建镜像时执行的命令"></a><strong>RUN：构建镜像时执行的命令</strong></h3><p><strong>1.shell执行</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN apk update</span><br></pre></td></tr></table></figure>

<p><strong>2.exec执行</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN [&quot;/etc/execfile&quot;, &quot;arg1&quot;, &quot;arg1&quot;]</span><br></pre></td></tr></table></figure>

<p>注:RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。<br>如果不想使用这些缓存镜像，可以在构建时指定–no-cache参数，如：docker build –no-cache</p>
<h3 id="ADD：将本地文件添加到容器中"><a href="#ADD：将本地文件添加到容器中" class="headerlink" title="ADD：将本地文件添加到容器中"></a><strong>ADD：将本地文件添加到容器中</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD hom* /mydir/          # 添加所有以&quot;hom&quot;开头的文件</span><br></pre></td></tr></table></figure>

<p>将本地文件添加到容器中，tar类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似wget</p>
<p><strong>copy与add完全一致</strong>，但是不能使用网络资源</p>
<h3 id="CMD：容器启动时调用的命令。"><a href="#CMD：容器启动时调用的命令。" class="headerlink" title="CMD：容器启动时调用的命令。"></a><strong>CMD：容器启动时调用的命令。</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD [&quot;/usr/bin/wc&quot;,&quot;--help&quot;]</span><br></pre></td></tr></table></figure>

<h3 id="EXPOSE：指定于外界交互的端口"><a href="#EXPOSE：指定于外界交互的端口" class="headerlink" title="EXPOSE：指定于外界交互的端口"></a><strong>EXPOSE：指定于外界交互的端口</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE 8080</span><br></pre></td></tr></table></figure>

<h3 id="WORKDIR：工作目录"><a href="#WORKDIR：工作目录" class="headerlink" title="WORKDIR：工作目录"></a><strong>WORKDIR：工作目录</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /path/to/workdir</span><br><span class="line">通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY等命令都会在该目录下执行。</span><br><span class="line">在使用docker run运行容器时，可以通过-w参数覆盖构建时所设置的工作目录。</span><br></pre></td></tr></table></figure>

<h3 id="ARG：用于指定传递给构建运行时的变量"><a href="#ARG：用于指定传递给构建运行时的变量" class="headerlink" title="ARG：用于指定传递给构建运行时的变量"></a><strong>ARG：用于指定传递给构建运行时的变量</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ARG PYTORCH=&quot;1.3&quot;</span><br><span class="line">ARG CUDA=&quot;10.1&quot;</span><br><span class="line">ARG CUDNN=&quot;7&quot;</span><br><span class="line"></span><br><span class="line">FROM pytorch/pytorch:$&#123;PYTORCH&#125;-cuda$&#123;CUDA&#125;-cudnn$&#123;CUDNN&#125;-devel</span><br></pre></td></tr></table></figure>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ARG PYTORCH=&quot;1.3&quot;</span><br><span class="line">ARG CUDA=&quot;10.1&quot;</span><br><span class="line">ARG CUDNN=&quot;7&quot;</span><br><span class="line"></span><br><span class="line">FROM pytorch/pytorch:$&#123;PYTORCH&#125;-cuda$&#123;CUDA&#125;-cudnn$&#123;CUDNN&#125;-devel</span><br><span class="line"></span><br><span class="line">ENV TORCH_CUDA_ARCH_LIST=&quot;6.0 6.1 7.0+PTX&quot;</span><br><span class="line">ENV TORCH_NVCC_FLAGS=&quot;-Xfatbin -compress-all&quot;</span><br><span class="line">ENV CMAKE_PREFIX_PATH=&quot;$(dirname $(which conda))/../&quot;</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y libglib2.0-0 libsm6 libxrender-dev libxext6 \</span><br><span class="line"> &amp;&amp; apt-get clean \</span><br><span class="line"> &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"># Install SOLO</span><br><span class="line">RUN conda install cython -y &amp;&amp; conda clean --all</span><br><span class="line">RUN git clone https://gitee.com/doge_ac_cn/SOLO /SOLO</span><br><span class="line">WORKDIR /SOLO</span><br><span class="line">RUN pip install --no-cache-dir -e .</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/27/python%E8%B8%A9%E5%9D%91-%E5%90%84%E7%B1%BB%E7%BC%96%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/27/python%E8%B8%A9%E5%9D%91-%E5%90%84%E7%B1%BB%E7%BC%96%E7%A0%81/" itemprop="url">python踩坑-各类编码问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-27T16:25:22+08:00">
                2021-07-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-python-json存储时乱码"><a href="#1-python-json存储时乱码" class="headerlink" title="1.python json存储时乱码"></a>1.python json存储时乱码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json_data = json.dumps(data_dict, indent=<span class="number">0</span>,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path_to_save + <span class="string">&#x27;/Result/&#x27;</span> + path_to_save + <span class="string">&#x27;.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json_data)</span><br></pre></td></tr></table></figure>

<p>json.dumps默认用ascii码存储，,ensure_ascii=False后才能正常转。</p>
<p>另外就是文件打开时需要编码为utf-8</p>
<h3 id="2-python-url-解析特殊字符报错"><a href="#2-python-url-解析特殊字符报错" class="headerlink" title="2.python url 解析特殊字符报错"></a>2.python url 解析特殊字符报错</h3><p>url带空格，+, = , ?等特殊字符导致urllib.request.urlopen(url)解析失败。</p>
<p>这里不是python包的问题，是本身传过来的url就不应该带这类字符。</p>
<p>开发中出现这个问题，需要先去跟同事沟通，确定问题来源。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dyyshb/article/details/82346699">具体解释的博客</a></p>
<h4 id="实在不行也可以python解决"><a href="#实在不行也可以python解决" class="headerlink" title="实在不行也可以python解决"></a>实在不行也可以python解决</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=url.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;%20&quot;</span>).replace(<span class="string">&quot;+&quot;</span>, <span class="string">&quot;%20&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot; %2F&quot;</span>) \</span><br><span class="line">    .replace(<span class="string">&quot;#&quot;</span>, <span class="string">&quot;%23&quot;</span>).replace(<span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;%26&quot;</span>).replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;%3D&quot;</span>)</span><br></pre></td></tr></table></figure>


<h3 id="3-opencv-puttext-中文乱码"><a href="#3-opencv-puttext-中文乱码" class="headerlink" title="3.opencv puttext 中文乱码"></a>3.opencv puttext 中文乱码</h3><h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>先转成PIL的图片格式，再用PIL绘制字体，然后再转回opencv图片格式</p>
<h4 id="定义方法"><a href="#定义方法" class="headerlink" title="定义方法"></a>定义方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cv2ImgAddText</span>(<span class="params">img, text, left, top, textColor=(<span class="params"><span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span></span>), textSize=<span class="number">20</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isinstance</span>(img, np.ndarray)):  <span class="comment"># 判断是否OpenCV图片类型</span></span><br><span class="line">        img = Image.fromarray(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))</span><br><span class="line">    <span class="comment"># 创建一个可以在给定图像上绘图的对象</span></span><br><span class="line">    draw = ImageDraw.Draw(img)</span><br><span class="line">    <span class="comment"># 字体的格式</span></span><br><span class="line">    fontStyle = ImageFont.truetype(</span><br><span class="line">        <span class="string">&quot;simsun.ttc&quot;</span>, textSize, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="comment"># 绘制文本</span></span><br><span class="line">    draw.text((left, top), text, textColor, font=fontStyle)</span><br><span class="line">    <span class="comment"># 转换回OpenCV格式</span></span><br><span class="line">    <span class="keyword">return</span> cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</span><br></pre></td></tr></table></figure>

<p>其中simsun.ttc需要自己下载到当前目录下，这个是新宋体的字体。</p>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">im0 = cv2ImgAddText(im0, <span class="string">f&quot;有效数量:<span class="subst">&#123;num&#125;</span>\n均值    :<span class="subst">&#123;average_length:<span class="number">.2</span>f&#125;</span>cm\n标准差  :<span class="subst">&#123;std_length:<span class="number">.2</span>f&#125;</span>cm&quot;</span>, <span class="number">0</span>, <span class="number">10</span>, (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">150</span>)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/27/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83%E8%B8%A9%E5%9D%91%E5%90%88%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/27/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83%E8%B8%A9%E5%9D%91%E5%90%88%E9%9B%86/" itemprop="url">神经网络训练踩坑合集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-27T16:03:21+08:00">
                2021-07-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h2><p><strong>1.ImageFolder读取时需要补零</strong></p>
<p>1.jpg,2.jpg,3.jpg …..999.jpg,1000.jpg</p>
<p>需要补零为0001.jpg,0002.jpg…0999.jpg,1000.jpg。</p>
<p>否则会顺序混乱。</p>
<p><strong>2.通道转换用transpose，而不是reshape</strong></p>
<p>把图像从[n,w,h,c]转为[n,c,w,h]时一定要注意用np.transpose。</p>
<p>不然整个图像会先被压为一维特征，然后再排列，而不是直接维度上转置。</p>
<p><strong>3.pytorch ToTensor对部署的影响</strong></p>
<p>transforms.ToTensor()操作之后，图像会从*[0, 255] -&gt; [0.0,1.0]*</p>
<p>部署时需要image /= 255.0</p>
<h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2><p><strong>1.train,eval 调整</strong></p>
<p>老生常谈了，训练时候记得切换。</p>
<p><strong>2.scheduler.step() optimizer.step() 位置写错</strong></p>
<p>这里可以用tensorboard实时监控学习率解决，防止写错位置学习率骤降</p>
<p><strong>3.忘记optimizer.zero_grad()</strong></p>
<h2 id="模型保存"><a href="#模型保存" class="headerlink" title="模型保存"></a>模型保存</h2><p><strong>1.save和load方法要对应</strong></p>
<p>尽量直接save model，而不是model.state_dict(),这样方便恢复训练</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">torch.save(model, model_path)</span><br><span class="line">model = torch.load(model_path)</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line">torch.save(model.state_dict(), PATH)</span><br><span class="line">model = init_model() <span class="comment"># 这里还需要初始化模型结构才能载入state dict</span></span><br><span class="line">model.load_state_dict(torch.load(PATH))</span><br><span class="line">model.<span class="built_in">eval</span>()</span><br></pre></td></tr></table></figure>



<h2 id="最终的解决方法"><a href="#最终的解决方法" class="headerlink" title="最终的解决方法"></a>最终的解决方法</h2><p>1.训练时用tensorboard监控学习率，处理图像时把预处理结束的图像放在tensorboard上。</p>
<p>2.如果模型不拟合，先用最少的样本测试模型能不能过拟合，测试整个流程有没有出问题。</p>
<p>3.尽量自己手写工具类，形成自己的代码库。防止出bug大量浪费时间。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/27/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83tip%E4%B9%8Bbatchsize%E5%92%8C%E5%AD%A6%E4%B9%A0%E7%8E%87%E5%A4%A7%E5%B0%8F%E5%85%B3%E7%B3%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/27/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83tip%E4%B9%8Bbatchsize%E5%92%8C%E5%AD%A6%E4%B9%A0%E7%8E%87%E5%A4%A7%E5%B0%8F%E5%85%B3%E7%B3%BB/" itemprop="url">神经网络训练tip之batchsize和学习率大小关系</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-27T15:58:20+08:00">
                2021-07-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>很多时候运行的项目，都是多卡训练出的，batchsize较大。</p>
<p>在调小batchsize的同时，要记得调小学习率。</p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1404.5997.pdf">参考论文:One weird trick for parallelizing convolutional neural networks</a><br>具体可看第5页中。</p>
<p>一般来说，我们batch size 大一些，则learning rate也要大一些</p>
<p>batch-size增大K倍，然后学习率增大$\sqrt{K}$倍</p>
<p>举例来说，原先别人的batch size 为128， learning rate为0.0005</p>
<p> 那么当我们把batch size改为1024时，则新的学习率有这样的推荐值：</p>
<p>$0.0005 ∗ \sqrt{1024 / 128} = 0.0005 ∗ \sqrt{8} = 0.001412 $</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/22/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87solo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/22/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87solo/" itemprop="url">神经网络论文solo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-22T07:00:00+08:00">
                2021-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/1912.04488"> 论文地址</a></p>
<p><img src="/2021/07/22/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87solo/solo_1.png" alt="网格结构"></p>
<p>和yolov1一样，采用s*s的网格，每个网格都预测一个mask。</p>
<p><img src="/2021/07/22/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87solo/solo_2.png" alt="同时预测type和mask"></p>
<p>预测时同时预测type和mask</p>
<p><img src="/2021/07/22/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87solo/solo_3.png" alt="decoupled head"></p>
<p>此时每个网格，实际都进行了一个fpn的运算量。</p>
<p>共计s*s个，运算量相当大。</p>
<p>但是其实不是每个网格都有物体，大部分都是冗余信息。</p>
<p>于是使用了decoupled head。</p>
<p><strong>同时预测x,y两个方向的s个图，最后再相乘得到mask。</strong></p>
<p>这样如果预测40*40的网格。</p>
<p>运算量就从40*40变成了40+40，大大降低运算量的同时，准确率还没有下降。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/18/20210718%E5%91%A8%E6%8A%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/18/20210718%E5%91%A8%E6%8A%A5/" itemprop="url">20210718周报</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-18T08:00:00+08:00">
                2021-07-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-项目"><a href="#1-项目" class="headerlink" title="1.项目"></a>1.项目</h2><p>已收到吴主任目前的项目计划：</p>
<p>HTN-LVH(高血压心肌病带有左室肥厚) vs HCM(肥厚性心肌病)人工智能与传统纹理分析的鉴别疾病的能力差异</p>
<p><strong>目前个人打算：</strong></p>
<p>传统纹理分析打算用svm,决策树，以及xgboost和lightgbm模型融合实验一下。</p>
<p>其中xgboost和lightgbm是数据竞赛用的，对数据的量以及实际和预测结果的相关度要求比较高,不一定可以拟合。</p>
<p>但是最后如果能拟合，就是秒杀其他算法的效果。</p>
<p>深度学习打算照着原论文思路基础修正细节，添加前沿模型结构。</p>
<h2 id="2-项目相关的kaggle比赛-19年到最近"><a href="#2-项目相关的kaggle比赛-19年到最近" class="headerlink" title="2.项目相关的kaggle比赛(19年到最近)"></a>2.项目相关的kaggle比赛(19年到最近)</h2><p>​    1.[RSNA Intracranial Hemorrhage Detection](RSNA Intracranial Hemorrhage Detection)</p>
<p>​    19年的颅内出血检测比赛，也是纯图像分类。</p>
<p>​    第一名的代码</p>
<p>​    <a target="_blank" rel="noopener" href="https://github.com/SeuTao/RSNA2019_Intracranial-Hemorrhage-Detection">Code for 1st Place Solution in Intracranial Hemorrhage Detection Challenge @ RSNA2019     </a></p>
<p>​    中文的解读</p>
<p>​    <a target="_blank" rel="noopener" href="https://blog.csdn.net/JMU_Ma/article/details/106444385">【Challenge笔记】RSNA Intracranial Hemorrhage Detection_</a> </p>
<p>​    2.<a target="_blank" rel="noopener" href="https://www.kaggle.com/c/rsna-str-pulmonary-embolism-detection"> RSNA STR Pulmonary Embolism Detection Classify Pulmonary</a></p>
<p>​    在胸部 CT 扫描中对肺栓塞病例进行分类。</p>
<p>​    20年的比赛，<a target="_blank" rel="noopener" href="https://www.kaggle.com/c/rsna-str-pulmonary-embolism-detection/leaderboard">排行榜</a>有开源code。目前在看第一名和第三名。</p>
<p>​    3.<a target="_blank" rel="noopener" href="https://www.kaggle.com/c/rsna-miccai-brain-tumor-radiogenomic-classification/rules">RSNA-MICCAI Brain Tumor Radiogenomic Classification(持续关注中)</a></p>
<p>​    今年的比赛，大脑图像分类，这周刚收到kaggle的参赛推送邮件。</p>
<p>​    难度很大，还有三个月比赛截止，目前最高准确率只有0.668。</p>
<p>​    先mark一下看看数据竞赛大佬的讨论。</p>
<p>总结：先去看19年冠军的代码，思路多，效果好。</p>
<h2 id="3-Deeplearning-AI在coursera-的AI-For-Medicine课程。"><a href="#3-Deeplearning-AI在coursera-的AI-For-Medicine课程。" class="headerlink" title="3. Deeplearning AI在coursera 的AI For Medicine课程。"></a>3. <a target="_blank" rel="noopener" href="https://www.coursera.org/specializations/ai-for-medicine">Deeplearning AI在coursera 的AI For Medicine课程</a>。</h2><p>第一课第一节收获：</p>
<p>基础的深度学习，涉及cnn,loss,dataset。</p>
<p>要记住的有3点：</p>
<p>\1.   划分数据集要按照患者分，而不是图片。</p>
<p>\2.   数据增强时，胸腔x光因为心脏位置，不能左右偏转。</p>
<p>\3.   样本每类数量不平衡，可以重采样构成数据集。</p>
<p>比如正负样本为60:4, 每次需要采样32个。</p>
<p>每次采样都取16:4*4，而不是 28:4。</p>
<p>否则会导致反传loss，正负样本起作用效果不均衡。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/15/python%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AE%80%E5%8C%96%E5%86%99%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/15/python%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AE%80%E5%8C%96%E5%86%99%E6%B3%95/" itemprop="url">python的一些简化写法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-15T08:00:00+08:00">
                2021-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-if"><a href="#1-if" class="headerlink" title="1.if"></a>1.if</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">1</span> <span class="keyword">if</span> y&gt;<span class="number">0</span> <span class="keyword">else</span> -<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="2-生成式"><a href="#2-生成式" class="headerlink" title="2.生成式"></a>2.生成式</h3><p>list</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x*<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br></pre></td></tr></table></figure>

<p>dict</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dic1 = &#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;2&#x27;</span>:<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;3&#x27;</span>:<span class="string">&#x27;three&#x27;</span>&#125; </span><br><span class="line">dic2 = &#123;v:k <span class="keyword">for</span> k,v <span class="keyword">in</span> dic1.items()&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-赋值"><a href="#3-赋值" class="headerlink" title="3.赋值"></a>3.赋值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多个元素同时赋值</span></span><br><span class="line">a,b = <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="comment"># 序列挨个赋值</span></span><br><span class="line"><span class="built_in">list</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">a,b,c,d =<span class="built_in">list</span> </span><br></pre></td></tr></table></figure>

<h3 id="4-map-reduce"><a href="#4-map-reduce" class="headerlink" title="4.map reduce"></a>4.map reduce</h3><p>map将传入的函数依次作用到序列的每个元素。</p>
<p>reduce把结果继续和序列的下一个元素做累积计算。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">     <span class="keyword">return</span> x * x</span><br><span class="line">r = <span class="built_in">map</span>(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br></pre></td></tr></table></figure>

<h3 id="5-匿名函数"><a href="#5-匿名函数" class="headerlink" title="5.匿名函数"></a>5.匿名函数</h3><p>配合map reduce非常好用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>(<span class="keyword">lambda</span> x: x * x, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">DIGITS = &#123;<span class="string">&#x27;0&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;1&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;4&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;5&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;6&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;7&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;8&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;9&#x27;</span>: <span class="number">9</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">char2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> DIGITS[s]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2int</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x * <span class="number">10</span> + y, <span class="built_in">map</span>(char2num, s))</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/15/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E9%A2%84%E5%A4%84%E7%90%86%E6%B1%87%E6%80%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/15/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E9%A2%84%E5%A4%84%E7%90%86%E6%B1%87%E6%80%BB/" itemprop="url">深度学习预处理汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-15T08:00:00+08:00">
                2021-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="标签平滑"><a href="#标签平滑" class="headerlink" title="标签平滑"></a>标签平滑</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrossEntropyLoss_label_smooth</span>(<span class="params">outputs, targets,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  num_classes=<span class="number">2</span>, epsilon=<span class="number">0.1</span></span>):</span></span><br><span class="line">    N = targets.size(<span class="number">0</span>)</span><br><span class="line">    smoothed_labels = torch.full(size=(N, num_classes),</span><br><span class="line">                                 fill_value=epsilon / (num_classes - <span class="number">1</span>))</span><br><span class="line">    targets = targets.data.cpu()</span><br><span class="line">    smoothed_labels.scatter_(dim=<span class="number">1</span>, index=torch.unsqueeze(targets, dim=<span class="number">1</span>),</span><br><span class="line">                             value=<span class="number">1</span> - epsilon)</span><br><span class="line">    <span class="comment"># outputs = outputs.data.cpu()</span></span><br><span class="line">    log_prob = nn.functional.log_softmax(outputs, dim=<span class="number">1</span>).cpu()</span><br><span class="line">    loss = - torch.<span class="built_in">sum</span>(log_prob * smoothed_labels) / N</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line">loss = CrossEntropyLoss_label_smooth(outputs, labels, num_classes=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://github.com/genhao3/PET">GitHub – genhao3/PET: 科大讯飞2020脑PET图像分析和疾病预测—单模型进决赛前五</a></p>
<p>原理参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/101553787">标签平滑&amp;深度学习：Google Brain解释了为什么标签平滑有用以及什么时候使用它 – 知乎 (zhihu.com)</a></p>
<h2 id="简单解释"><a href="#简单解释" class="headerlink" title="简单解释"></a>简单解释</h2><p>对于常规的onehot标签，为了防止出现局部最优的现象，本步骤中对样本生成的独热编码进行平滑，增大分类的泛化能力，具体步骤如下：<br>1）获取标签个数<br>2）根据标签个数和类别个数生成平滑单位矩阵，里面的值以既定平滑系数/（类别数-1）<br>3）标签数值平滑，即对数值为1的位置项该值减去平滑系数，其余项加上平滑系数的倒数，生成符合原标签数值分布的标签系数矩阵<br>4）然后对原标签矩阵进行对数交叉熵映射，然后对映射后的结果乘以平滑后的标签系数矩阵生成最终的标签矩阵。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/15/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83tip%E4%B9%8Btensorboard%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/15/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83tip%E4%B9%8Btensorboard%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/" itemprop="url">神经网络训练tip之tensorboard函数总结.md</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-15T08:00:00+08:00">
                2021-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-编写"><a href="#1-编写" class="headerlink" title="1.编写"></a>1.编写</h2><p>先初始化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line">writer = SummaryWriter(comment =<span class="string">f&#x27;LR_<span class="subst">&#123;lr&#125;</span>_BS_<span class="subst">&#123;batch_size&#125;</span>_SCALE_<span class="subst">&#123;img_scale&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>散点图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writer.add_scalar(<span class="string">&#x27;Loss/train&#x27;</span>, loss.item(), global_step) </span><br></pre></td></tr></table></figure>

<p>直方图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writer.add_histogram(<span class="string">&#x27;weights/&#x27;</span>+tag, value.data.cpu().numpy(),global_step)</span><br></pre></td></tr></table></figure>

<p>绘图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">writer.add_images(<span class="string">&#x27;masks/true&#x27;</span>, true_masks, global_step)</span><br><span class="line">writer.add_images(<span class="string">&#x27;masks/pred&#x27;</span>, torch.sigmoid(masks_pred) &gt; <span class="number">0.5</span>, global_step)</span><br></pre></td></tr></table></figure>



<h2 id="2-查看"><a href="#2-查看" class="headerlink" title="2.查看"></a>2.查看</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorboard --logdir=runs</span><br></pre></td></tr></table></figure>

<p>这里的runs为tensorboard<strong>保存log</strong>的目录，默认为<strong>当前文件夹下的runs文件夹</strong></p>
<p>然后进入<a target="_blank" rel="noopener" href="http://localhost:6006/">http://localhost:6006/</a> 即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/11/20210711%E5%91%A8%E6%8A%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="柴犬的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/11/20210711%E5%91%A8%E6%8A%A5/" itemprop="url">20210711周报</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-11T08:00:00+08:00">
                2021-07-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>1.</strong> <strong>项目论文一</strong></p>
<p>Radiomic Analysis of MyocardialNative T1Imaging DiscriminatesBetween Hypertensive Heart Diseaseand Hypertrophic Cardiomyopathy</p>
<p>使用svm，输入纹理特征，输出辨别高血压心脏病和肥厚型心肌病。</p>
<p>对纹理特征不熟悉(都不知道是什么)，有时间的时候找找相关资料了解一下。</p>
<p><strong>2.</strong> <strong>项目论文二</strong></p>
<p>Deep Learning for Diagnosis of Chronic Myocardial Infarction on Nonenhanced Cardiac Cine MRI</p>
<p>深度学习检测慢性心肌梗死。</p>
<p>代码已开源<a target="_blank" rel="noopener" href="https://github.com/xuchenchuzw/MI-Segmentation#mlsegmentation">xuchenchuzw/MI-Segmentation (github.com)</a></p>
<p>1.先训练一个目标检测网络确定ROI区域。这个目标检测网络很简单，先用一个alexnet改的神经网络提取特征，然后在特征图上通过anchor box确定roi区域。(rcnn系列的思路)</p>
<p>2.然后对这个区域取25帧训练特征提取网络，提取25*n的特征。再对这个时序特征过lstm，得到局部特征向量。</p>
<p>3.另一个网络提取全局的运动特征，得到全局特征向量。</p>
<p>4.最后把两个特征向量拼接，过一个autoencoder得到预测结果。</p>
<p><strong>阅读感受</strong>：</p>
<p>优化空间非常巨大(毕竟距离这篇论文的代码编写已经三年过去了，主流模型升级巨大)。</p>
<p>1.检测网络可以用性能更好的目标检测网络。</p>
<p>2.lstm可以换transformer。</p>
<p>3.最后的stacked autoencoder其实就是个简单的神经网络，应该也可以优化。</p>
<p><strong>3.</strong> <strong>其他论文</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lifei1229/article/details/105991210">关于新冠肺炎（COVID-19）论文解读集合</a></p>
<p>新冠肺炎属于去年刚出的领域，因此它的分类识别也一定刚出了很多论文。</p>
<p>所以看了去年新冠肺炎识别的论文，方便开展心脏病分类的项目。</p>
<p>Using Artificial Intelligence to Detect COVID-19 and Community-acquired Pneumonia Based on Pulmonary CT: Evaluation of the Diagnostic Accuracy</p>
<p>可以参考它的预处理<br> **Preprocessing:**CT images were extracted from Digital Imaging and Communications in Medicine (DICOM) files. We then followed the following steps to preprocess the CT images. First, the lung region is extracted as the region of interest (ROI) using a U-net (1) based segmentation method. Afterward, the extracted lung ROI was resampled to the same spacing (1 mm) in the z-direction. To reduce the dimensionality of the CT scan, we further down sampled the lung ROI by 5 times in the z-direction and scaled it to S × 224 × 224 pixels with S as the number of CT slices in the down sampled lung ROI. Then, the voxel intensity values were first clipped using a window/level of 1500HU/-500HU and were then normalized to the range of [0, 1]. To reduce the influence of vascular structure and boost the signals of the lesions, a maximum intensity projection (MIP) algorithm was also applied to each of the slices. Finally, the preprocessed image is then passed to the proposed COVID-19 detection neural network (COVNet) for the predictions.</p>
<p><strong>Data augmentation:</strong> Each training example was rotated randomly between —3 and 3 degrees and flipped horizontally or vertically with 50% probability. We further add random Gaussian noise with a maximum variance of 0.015 to the image. </p>
<p><strong>Implementation details:</strong> COVNet was implemented with Python 3.7 and PyTorch 1.4 (2) and training with an NVIDIA V100 GPU. The weights of the ResNet50 (3) backbone of the COVNet was first initialized to values optimized on the ImageNet database (4) and were then fine-tuned to fit our chest CT dataset. The cross-entropy loss was used to optimize the model. The model with the highest accuracy on the internal validation set was chosen for evaluation on the independent testing set. The code to reproduce the results in this study is made available via: <a target="_blank" rel="noopener" href="https://github.com/bkong999/COVNet.git">https://github.com/bkong999/COVNet.git</a>. </p>
<p>顺便解决了个他git的一个简单issue <a target="_blank" rel="noopener" href="https://github.com/bkong999/COVNet/issues/28">place of softmax function · Issue #28 · bkong999/COVNet (github.com)</a></p>
<p>另外他用了Grad-Cam来体现神经网络的可解释性，这个比较有意思。打算花点时间看看。 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90055970">1. Grad-CAM阅读笔记 -神经网络输出可视化 - 知乎 (zhihu.com)</a></p>
<p>20210709复现完成</p>
<p><strong>4.</strong> <strong>论文复现流程</strong></p>
<p>先不搞分割了，把之前写完的代码打个包上传git了，以后搞分割项目再回来看。</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/doge_ac_cn/unet3d">柴犬/unet3d - 码云 - 开源中国 (gitee.com)</a></p>
<p><strong>5.</strong> <strong>问了一下cv交流群，关于之前别人给的ct图片读取是全黑的问题,知道了转rgb值会有精度损失，以及需要设置窗位和窗宽</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/">&lt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">&gt;</a>
  </nav>




          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">40</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Doge</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
